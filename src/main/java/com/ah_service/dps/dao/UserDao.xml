<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ah_service.dps.dao.UserDao">
    <insert id="addDoctor" parameterType="doctor">
        insert into doctor(doc_name, doc_loginno, doc_password, doc_sex, doc_age, doc_speciality,
         doc_desc, doc_medicineId, doc_headimg, crtuser, crtdate)
        VALUES (#{docName}, #{docLoginno}, #{docPasswordMd5}, #{docSex}, #{docAge}, #{docSpeciality},
        #{docDesc}, #{docMedicineId}, #{docHeadimg}, #{crtuser}, now())
    </insert>

    <update id="updDoctor" parameterType="doctor">
        update doctor set doc_name = #{docName}, doc_loginno = #{docLoginno}, doc_sex = #{docSex},
         doc_age = #{docAge}, doc_speciality = #{docSpeciality}, doc_desc = #{docDesc}, doc_medicineId = #{docMedicineId},
          <if test="docHeadimg != null and docHeadimg != ''">
             doc_headimg = #{docHeadimg},
          </if>
           upduser = #{upduser}, `update` = now() where doc_id = #{docId}
    </update>

    <select id="checkNoAndPass" resultType="doctor" parameterType="doctor" resultMap="doctorMap">
        select doc_id, doc_name, doc_loginno, doc_password, doc_sex,
        doc_age, doc_speciality, doc_desc, doc_medicineId, doc_hospital, doc_headimg,
        isadmin, ishosadmin,
        h.hos_id, h.hos_area, h.hos_city, h.hos_awards, h.hos_desc, h.hos_grade, h.hos_logo,
        h.hos_linkphone, h.hos_medicine, h.hos_name,
        (select data_name from bs_basedict where dict_code = 'HOS01' and data_code = h.hos_grade) hos_grade_name,
        (select name from city where city_id = h.hos_city) hos_city_name,
        (select name from area where area_id = h.hos_area) hos_area_name
        from doctor d left join hospital h on d.doc_hospital = h.hos_id
        where d.doc_loginno = #{docLoginno} and d.doc_password = #{docPasswordMd5} and d.recsts = '1'
    </select>

    <select id="doctorList" resultType="doctor" parameterType="doctor">
        select doc_id, doc_name, doc_loginno, doc_password, doc_sex,
        doc_age, doc_speciality, doc_desc, doc_medicineId, doc_hospital, doc_headimg,
        (select div_name from division where div_id = d.doc_medicineId) doc_medicine_name,
        (select hos_name from hospital where hos_id = d.doc_hospital) doc_hospital_name,
        isadmin, ishosadmin from doctor d where recsts = '1'
        <if test="isadmin == null or isadmin == false">
            and doc_hospital = #{docHospital}
        </if>

        <if test="docName != null and docName != ''">
            and doc_name = #{docName}
        </if>
        <if test="docMedicineId != null and docMedicineId != ''">
            and doc_medicineId = #{docMedicineId}
        </if>
    </select>

    <select id="getDoctorDetail" resultType="doctor">
        select doc_id, doc_name, doc_loginno, doc_password, doc_sex,
        doc_age, doc_speciality, doc_desc, doc_medicineId, doc_hospital, doc_headimg,
        (select div_name from division where div_id = d.doc_medicineId) doc_medicine_name,
        (select hos_name from hospital where hos_id = d.doc_hospital) doc_hospital_name,
        isadmin, ishosadmin from doctor d where recsts = '1' and doc_id = #{id}
    </select>
    <select id="hasSameDoctor" resultType="int" parameterType="doctor">
        select count(*) from doctor where doc_loginno = #{docLoginno}
        <if test="docId != null and docId != ''">
            and doc_id != #{docId}
        </if>
    </select>

    <resultMap id="doctorMap" type="doctor">
        <id property="docId" column="doc_id"/>
        <result property="docName" column="doc_name"/>
        <result property="docLoginno" column="doc_loginno"/>
        <result property="docSex" column="doc_sex"/>
        <result property="docAge" column="doc_age"/>
        <result property="docSpeciality" column="doc_speciality"/>
        <result property="docDesc" column="doc_desc"/>
        <result property="docMedicineId" column="doc_medicineId"/>
        <result property="docHospital" column="doc_hospital"/>
        <result property="docHeadimg" column="doc_headimg"/>
        <result property="isadmin" column="isadmin"/>
        <result property="ishosadmin" column="ishosadmin"/>
        <association property="hospital" javaType="hospital">
            <id column="hos_id" property="hosId"/>
            <result column="hos_area" property="hosArea"/>
            <result column="hos_city" property="hosCity"/>
            <result column="hos_awards" property="hosAwards"/>
            <result column="hos_desc" property="hosDesc"/>
            <result column="hos_grade" property="hosGrade"/>
            <result column="hos_logo" property="hosLogo"/>
            <result column="hos_grade_name" property="hosGradeName"/>
            <result column="hos_city_name" property="hosCityName"/>
            <result column="hos_area_name" property="hosAreaName"/>
            <result column="hos_linkphone" property="hosLinkphone"/>
            <result column="hos_medicine" property="hosMedicine"/>
            <result column="hos_name" property="hosName"/>
        </association>
    </resultMap>
</mapper>